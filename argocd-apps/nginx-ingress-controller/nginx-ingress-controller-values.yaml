# Custom values for nginx-ingress-controller Helm chart.
# Assumptions: AWS EKS cluster; prerequisites: IAM roles for service accounts if needed.
# Official chart: https://kubernetes.github.io/ingress-nginx, version 4.11.3

controller:
  replicaCount: 2
  service:
    type: LoadBalancer  # For AWS, this creates an ELB; use annotations for ALB if preferred
    annotations:
      service.beta.kubernetes.io/aws-load-balancer-type: "nlb"  # Use NLB for better performance; change to "classic" or remove for ELB
      service.beta.kubernetes.io/aws-load-balancer-scheme: "internet-facing"
  resources:
    requests:
      cpu: 100m
      memory: 90Mi
    limits:
      cpu: 200m
      memory: 180Mi
  config:
    use-forwarded-headers: "true"
    compute-full-forwarded-for: "true"
    use-proxy-protocol: "false"  # Enable if NLB uses proxy protocol
    log-format-upstream: '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" $request_length $request_time $upstream_response_time $pipe $upstream_addr'
  metrics:
    enabled: false
    serviceMonitor:
      enabled: false  # For Prometheus integration
  admissionWebhooks:
    enabled: true
  podSecurityContext:
    runAsUser: 101  # Non-root
    fsGroup: 101
  securityContext:
    allowPrivilegeEscalation: false
  rbac:
    create: true
    scope: cluster  # Cluster-wide for ingress

# No persistence needed for ingress-nginx